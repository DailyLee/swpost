<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>postMessage</title>
</head>
<body>
<div id="content"></div>
<script>
    var content = document.getElementById('content');
    content.innerHTML = new Date().getTime() + ''

    console.log('navigator.serviceWorker', navigator.serviceWorker.controller)
    console.log('navigator.serviceWorker.controller', navigator.serviceWorker.controller)
    console.log('navigator.serviceWorker.controller.state', navigator.serviceWorker.controller.state)

    navigator.serviceWorker.addEventListener("message", receiveMessage);

    function receiveMessage(event) {
        // For Chrome, the origin property is in the event.originalEvent
        // object.
        // 这里不准确，chrome没有这个属性
        // var origin = event.origin || event.originalEvent.origin;
        console.log('receiveMessage', event.data)
        if (event.data.meta === 'mihoyo-sw-broadcast-update') {
            console.log('mihoyo-sw-broadcast-update');
            content.innerHTML = JSON.stringify(event.data.payload);
        }
    }
</script>
</body>
</html>
